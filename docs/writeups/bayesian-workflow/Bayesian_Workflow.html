<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-28">

<title>[DSAN5650 Lab] Bayesian Workflow: A Modeling Adventure – DSAN 5650</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-b2511bcbb01c2159fd96a78deb42ffd9.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font@master/fonts.css"><script src="../../sidebar.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../dsan-globals/jjstyles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      DSAN 5650: Causal Inference for Computational Social Science
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DSAN 5650: Causal Inference for Computational Social Science</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><i class="bi bi-house pe-1"></i> Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../writeups/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writeups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://georgetown.zoom.us/j/94493188667?pwd=s4Q8TbTwZTNyK0G0VJsVe1Lefrd3AY.1" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Zoom Link <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://georgetown.hosted.panopto.com/Panopto/Pages/Sessions/List.aspx?folderID=413d999a-16d1-4b36-93b6-b2de013af117" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Recordings <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w01/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1: May 21</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w02/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2: May 28</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w03/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Jun 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w04/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4: Jun 11</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w05/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Jun 18</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../w06/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6: Jun 25</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://guhub.io" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">JupyterHub <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://jjacobs.me/meet" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Office Hours <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://forms.gle/PoyySPdVeBN37oBb8" class="sidebar-item-text sidebar-link" target="_blank">
 <span class="menu-text">Anonymous Feedback <i class="bi bi-box-arrow-up-right ps-1"></i></span></a>
  </div>
</li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p><em>Updated 2025-06-30, 03:47:38 AM</em></p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-elden-coin-the-immersive-coin-flipping-rpg-thats-taking-the-world-by-storm" id="toc-part-1-elden-coin-the-immersive-coin-flipping-rpg-thats-taking-the-world-by-storm" class="nav-link active" data-scroll-target="#part-1-elden-coin-the-immersive-coin-flipping-rpg-thats-taking-the-world-by-storm">[Part 1] Elden Coin: The Immersive Coin-Flipping RPG That’s Taking the World By Storm!</a>
  <ul class="collapse">
  <li><a href="#part-1.1-the-rules-of-the-game" id="toc-part-1.1-the-rules-of-the-game" class="nav-link" data-scroll-target="#part-1.1-the-rules-of-the-game">[Part 1.1] The Rules of the Game</a></li>
  <li><a href="#part-1.2-simulating-a-round" id="toc-part-1.2-simulating-a-round" class="nav-link" data-scroll-target="#part-1.2-simulating-a-round">[Part 1.2] Simulating a Round</a></li>
  <li><a href="#part-1.3-checking-the-math" id="toc-part-1.3-checking-the-math" class="nav-link" data-scroll-target="#part-1.3-checking-the-math">[Part 1.3] Checking the Math</a></li>
  <li><a href="#part-1.4-simulating-many-rounds" id="toc-part-1.4-simulating-many-rounds" class="nav-link" data-scroll-target="#part-1.4-simulating-many-rounds">[Part 1.4] Simulating Many Rounds</a></li>
  </ul></li>
  <li><a href="#part-2-simulating-the-unlockable-sheisty-coin" id="toc-part-2-simulating-the-unlockable-sheisty-coin" class="nav-link" data-scroll-target="#part-2-simulating-the-unlockable-sheisty-coin">[Part 2] Simulating the Unlockable <em>Sheisty Coin</em></a>
  <ul class="collapse">
  <li><a href="#part-2.1-simulating-biased-round-outcomes" id="toc-part-2.1-simulating-biased-round-outcomes" class="nav-link" data-scroll-target="#part-2.1-simulating-biased-round-outcomes">[Part 2.1] Simulating Biased <em>Round</em> Outcomes</a></li>
  <li><a href="#part-2.2-simulating-biased-match-outcomes" id="toc-part-2.2-simulating-biased-match-outcomes" class="nav-link" data-scroll-target="#part-2.2-simulating-biased-match-outcomes">[Part 2.2] Simulating Biased <em>Match</em> Outcomes</a></li>
  </ul></li>
  <li><a href="#part-3-moving-to-pymc-modeling-the-season-2-dynamic" id="toc-part-3-moving-to-pymc-modeling-the-season-2-dynamic" class="nav-link" data-scroll-target="#part-3-moving-to-pymc-modeling-the-season-2-dynamic">[Part 3] Moving to PyMC: Modeling the Season 2 Dynamic</a>
  <ul class="collapse">
  <li><a href="#part-3.1-why-would-you-play-at-all" id="toc-part-3.1-why-would-you-play-at-all" class="nav-link" data-scroll-target="#part-3.1-why-would-you-play-at-all">[Part 3.1] Why Would You Play At All?</a></li>
  <li><a href="#part-3.2-modeling-prtextsfheads-mid-textsfsheisty" id="toc-part-3.2-modeling-prtextsfheads-mid-textsfsheisty" class="nav-link" data-scroll-target="#part-3.2-modeling-prtextsfheads-mid-textsfsheisty">[Part 3.2] Modeling <span class="math inline">\(\Pr(\textsf{Heads} \mid \textsf{Sheisty})\)</span></a></li>
  <li><a href="#part-3.3-the-prior-distribution" id="toc-part-3.3-the-prior-distribution" class="nav-link" data-scroll-target="#part-3.3-the-prior-distribution">[Part 3.3] The Prior Distribution</a></li>
  <li><a href="#part-3.3-the-prior-predictive-distribution" id="toc-part-3.3-the-prior-predictive-distribution" class="nav-link" data-scroll-target="#part-3.3-the-prior-predictive-distribution">[Part 3.3] The Prior <em>Predictive</em> Distribution</a></li>
  </ul></li>
  <li><a href="#part-4-updating-on-observed-data" id="toc-part-4-updating-on-observed-data" class="nav-link" data-scroll-target="#part-4-updating-on-observed-data">[Part 4] Updating On Observed Data</a>
  <ul class="collapse">
  <li><a href="#part-4.1-your-single-observed-match" id="toc-part-4.1-your-single-observed-match" class="nav-link" data-scroll-target="#part-4.1-your-single-observed-match">[Part 4.1] Your (Single) Observed Match</a></li>
  <li><a href="#part-4.2-adding-the-observations-to-our-model-and-updating" id="toc-part-4.2-adding-the-observations-to-our-model-and-updating" class="nav-link" data-scroll-target="#part-4.2-adding-the-observations-to-our-model-and-updating">[Part 4.2] Adding the Observations to Our Model and Updating</a></li>
  <li><a href="#part-4.3-sample-from-posterior-distribution" id="toc-part-4.3-sample-from-posterior-distribution" class="nav-link" data-scroll-target="#part-4.3-sample-from-posterior-distribution">[Part 4.3] Sample from Posterior Distribution</a></li>
  <li><a href="#part-4.4-sample-from-posterior-predictive-distribution" id="toc-part-4.4-sample-from-posterior-predictive-distribution" class="nav-link" data-scroll-target="#part-4.4-sample-from-posterior-predictive-distribution">[Part 4.4] Sample from Posterior <em>Predictive</em> Distribution</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jpowerj/dsan5650/blob/main/writeups/bayesian-workflow/Bayesian_Workflow.ipynb" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">[DSAN5650 Lab] Bayesian Workflow: A Modeling Adventure</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Labs</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 28, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="448f0ef4-ecfb-467b-b505-bce2a6de7cb0" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:00.333356Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:00.333187Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:00.338925Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:00.338475Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:00.333339Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>html</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>style<span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">@import</span> url(<span class="st">'https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&amp;display=swap'</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>.jp<span class="op">-</span>RenderedHTMLCommon {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    font<span class="op">-</span>family: <span class="st">"Roboto"</span>, sans<span class="op">-</span>serif<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>style<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
.jp-RenderedHTMLCommon {
    font-family: "Roboto", sans-serif;
}
</style>
</div>
</div>
<div id="656645d8-de20-4921-8cd0-395ef4f1a9cd" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:01.759117Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:01.758832Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:03.263903Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:03.263299Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:01.759096Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>os.environ[ <span class="st">'MPLCONFIGDIR'</span> ] <span class="op">=</span> <span class="st">'./tmp/'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config IPCompleter.use_jedi <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span><span class="dv">5660</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.gridspec <span class="im">import</span> GridSpec</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.set_style('whitegrid')</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>cb_palette <span class="op">=</span> [<span class="st">'#e69f00'</span>,<span class="st">'#56b4e9'</span>,<span class="st">'#009e73'</span>]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>sns.set_palette(cb_palette)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> patchworklib <span class="im">as</span> pw<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 100x100 with 0 Axes&gt;</code></pre>
</div>
</div>
<section id="part-1-elden-coin-the-immersive-coin-flipping-rpg-thats-taking-the-world-by-storm" class="level2">
<h2 class="anchored" data-anchor-id="part-1-elden-coin-the-immersive-coin-flipping-rpg-thats-taking-the-world-by-storm">[Part 1] Elden Coin: The Immersive Coin-Flipping RPG That’s Taking the World By Storm!</h2>
<section id="part-1.1-the-rules-of-the-game" class="level3">
<h3 class="anchored" data-anchor-id="part-1.1-the-rules-of-the-game">[Part 1.1] The Rules of the Game</h3>
<ul>
<li>A friend <span class="math inline">\(B\)</span> challenges you (<span class="math inline">\(A\)</span>) to a <strong>match</strong> of Elden Coin (<span class="math inline">\(B\)</span> provides their Elden Coin, as well as the table to play on, which is a key part of the game), a tabletop coin-flipping game</li>
<li>A <strong>match</strong> is a series of <strong>50 rounds</strong></li>
<li>At the start of each round, both you and <span class="math inline">\(B\)</span> put <strong>one Euro</strong> (€1) into the pot on the side of the table, then write a big “0” in chalk on the other side</li>
<li>Then, the round consists of you and <span class="math inline">\(B\)</span> taking turns flipping the Elden Coin in the center of the table until you’ve reached <strong>13 total flips</strong></li>
<li>Every time a flip comes up <strong>Heads</strong>, you add one to the number written in chalk (by erasing and rewriting it)</li>
<li>At the end of the round:
<ul>
<li>If the number of heads written down is <strong>above 6</strong>, you (<span class="math inline">\(A\)</span>) win the entire pot (€2), meaning that you gain an additional Euro above the amount you entered the round with.</li>
<li>Otherwise, <span class="math inline">\(B\)</span> wins the entire pot, meaning that you lose one Euro relative to the amount you entered the round with.</li>
</ul></li>
</ul>
<p>The following cell defines a <code>Game</code> class, that we can use to store the different parameters we’ll need when simulating a match.</p>
<div id="1dc5ddf8-6d64-4da5-8873-800fd0d8eaff" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:03.265050Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:03.264729Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:03.268032Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:03.267578Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:03.265031Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Game:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    flips_per_round <span class="op">=</span> <span class="dv">13</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    num_heads_range <span class="op">=</span> (<span class="dv">0</span>, flips_per_round)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    num_heads_support <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, flips_per_round <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    win_cutoff <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    rounds_per_match <span class="op">=</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, on top of just the rules of the game itself, here we define a separate set of globals “outside of” the game, specifying the number of simulations of the game we’d like to run in our simulation cells (so that, for example, you can set it to lower values if running on a slower computer or if you just want the cells to run more quickly!)</p>
<div id="63c29e44-506b-4d55-a19b-a600d3a2e287" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:03.697357Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:03.697149Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:03.700122Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:03.699669Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:03.697339Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyGlobals:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we're trying to get a distribution over what might happen in *one round*</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of the game (with outcomes Win or Lose), we'll use this many simulations</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    rounds_to_sim <span class="op">=</span> <span class="dv">10_000</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, for obtaining a distribution over what might happen in a *match*</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (with the outcome being the total amount of money won or lost), we'll use</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this many</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    matches_to_sim <span class="op">=</span> <span class="dv">1_000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1.2-simulating-a-round" class="level3">
<h3 class="anchored" data-anchor-id="part-1.2-simulating-a-round">[Part 1.2] Simulating a Round</h3>
<p>If we <em>truly</em> wanted to work at the most fine-grained level, we could simulate individual coin flips, one-by-one</p>
<div id="9a2f6493-d56e-461b-9f59-7fe152d7a745" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:04.218668Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:04.218414Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:04.222507Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:04.222065Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:04.218649Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sim_round_flips(p):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    round_flips <span class="op">=</span> rng.choice([<span class="dv">0</span>,<span class="dv">1</span>],p<span class="op">=</span>[<span class="dv">1</span><span class="op">-</span>p, p], size<span class="op">=</span>Game.flips_per_round)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> round_flips</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sim_round_flips(<span class="fl">0.5</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sim_round_flips(<span class="fl">0.85</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0 0 1 0 0 0 0 0 1 0 1 0 1]
[1 0 1 1 1 1 1 1 1 1 0 0 1]</code></pre>
</div>
</div>
<p>Then, to check the outcome at the level of number-of-heads, we could just use <code>sum()</code>:</p>
<div id="c5d5b083-da41-41e5-ad8f-c81fb0cc018d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:04.531196Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:04.530991Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:04.534823Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:04.534372Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:04.531178Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(sim_round_flips(<span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>6</code></pre>
</div>
</div>
<p>But, if we’re going to just sum up the individual coin flips anyways, we can achieve a pretty massive speed improvement (not noticeable for only one or a few rounds, but massive once we move to the level of simulating thousands of rounds) by using <code>rng.binomial()</code>, that is, by operating at the coarser-grained level of generating [number of heads out of 9 flips] rather than individual 0/1 heads/tails values:</p>
<div id="952c3989-00d9-4feb-bfd2-8a59c7706f0f" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:04.834732Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:04.834527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:04.838180Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:04.837763Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:04.834714Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sim_round(p):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    num_heads <span class="op">=</span> <span class="bu">int</span>(rng.binomial(n<span class="op">=</span>Game.flips_per_round, p<span class="op">=</span>p, size<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num_heads</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>sim_round(<span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>6</code></pre>
</div>
</div>
<p>So, let’s do some simulations (we’ll use <code>MyGlobals.rounds_to_sim</code>, set above, as our number of simulations <span class="math inline">\(N\)</span>), by running this function a bunch of times, to see how often the number of heads is above 6 when the coin is fair…</p>
<div id="1a97d767-ae5f-4841-b237-1d63e1596218" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:05.164820Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:05.164652Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:05.201905Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:05.201460Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:05.164806Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_counts(df):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    support_df <span class="op">=</span> pd.DataFrame({<span class="st">'num_heads'</span>: Game.num_heads_support})</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    count_df <span class="op">=</span> df[<span class="st">'num_heads'</span>].value_counts().reset_index().sort_values(by<span class="op">=</span><span class="st">'num_heads'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> support_df.merge(count_df, on<span class="op">=</span><span class="st">'num_heads'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'win'</span>] <span class="op">=</span> merged_df[<span class="st">'num_heads'</span>] <span class="op">&gt;</span> Game.win_cutoff</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'count'</span>] <span class="op">=</span> merged_df[<span class="st">'count'</span>].replace(np.nan, <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    merged_df[<span class="st">'Pr(num_heads)'</span>] <span class="op">=</span> merged_df[<span class="st">'count'</span>] <span class="op">/</span> merged_df[<span class="st">'count'</span>].<span class="bu">sum</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_df</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fair_sim_result <span class="op">=</span> [sim_round(<span class="fl">0.5</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(MyGlobals.rounds_to_sim)]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>fair_sim_df <span class="op">=</span> pd.DataFrame({<span class="st">'num_heads'</span>: fair_sim_result, <span class="st">'params'</span>: <span class="st">'p = 0.5'</span>})</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>fair_sim_df[<span class="st">'win'</span>] <span class="op">=</span> fair_sim_df[<span class="st">'num_heads'</span>] <span class="op">&gt;</span> Game.win_cutoff</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>fair_count_df <span class="op">=</span> get_counts(fair_sim_df)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>fair_count_df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">num_heads</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">count</td>
<td>0</td>
<td>22</td>
<td>116</td>
<td>376</td>
<td>874</td>
<td>1593</td>
<td>1990</td>
<td>2065</td>
<td>1577</td>
<td>890</td>
<td>382</td>
<td>101</td>
<td>13</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">win</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pr(num_heads)</td>
<td>0.0</td>
<td>0.0022</td>
<td>0.0116</td>
<td>0.0376</td>
<td>0.0874</td>
<td>0.1593</td>
<td>0.199</td>
<td>0.2065</td>
<td>0.1577</td>
<td>0.089</td>
<td>0.0382</td>
<td>0.0101</td>
<td>0.0013</td>
<td>0.0001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And we can plot the distribution of these simulated outcomes, assigning different colors to the outcomes where we win and where we lose:</p>
<div id="fcf4d78a-501c-4e13-8e00-384d66ad30f6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:05.476671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:05.476459Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:05.666643Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:05.666174Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:05.476653Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>,<span class="fl">2.25</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.barplot(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"num_heads"</span>, y<span class="op">=</span><span class="st">"Pr(num_heads)"</span>, hue<span class="op">=</span><span class="st">"win"</span>, data<span class="op">=</span>fair_count_df,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">6.5</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"N = </span><span class="sc">{</span><span class="bu">len</span>(fair_sim_result)<span class="sc">}</span><span class="ss"> Simulated Rounds, p = 0.5"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To make it even more straightforward to see the fairness of the game (given a fair coin!), we can just plot win and loss proportions directly:</p>
<div id="ecb9d5e8-4562-4105-bf22-30173a704718" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:05.792389Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:05.792101Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:05.799343Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:05.798920Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:05.792363Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fair_win_df <span class="op">=</span> fair_count_df[[<span class="st">'win'</span>,<span class="st">'count'</span>]].groupby(<span class="st">"win"</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fair_win_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">win</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>4971</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True</td>
<td>5029</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="59334d37-0ce9-4690-8c82-0a56c2fbdd0d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:05.955534Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:05.955321Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:06.069710Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:06.069255Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:05.955518Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>,<span class="fl">2.25</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>win_plot <span class="op">=</span> sns.barplot(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"win"</span>, y<span class="op">=</span><span class="st">"count"</span>, hue<span class="op">=</span><span class="st">"win"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>fair_win_df,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>win_plot.set_title(<span class="st">"Wins vs. Losses"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-1.3-checking-the-math" class="level3">
<h3 class="anchored" data-anchor-id="part-1.3-checking-the-math">[Part 1.3] Checking the Math</h3>
<p>So far, individual rounds of this game look pretty fair. But, can we be <em>mathematically sure</em> they are?</p>
<p>Let’s say we didn’t even trust this <span class="math inline">\(N = 10000\)</span> simulation. Something that I think is good to have in your toolkit, for checking the math on this stuff without needing to take out a piece of paper, is a <strong>symbolic mathematics system!</strong></p>
<p><code>SymPy</code>, in this case, can be used to derive exact closed-form solutions (when possible) to probability theory problems, so that you don’t even have to depend on running simulations for simple enough problems! You can find the documentation for the <code>SymPy</code> stats module <a href="https://docs.sympy.org/latest/modules/stats.html">here</a>, but the following cells should give you the gist as we check the math of the game’s fairness.</p>
<p>As a quick demonstration of why SymPy is useful, let’s say we’re trying to remember the <a href="https://math.stackexchange.com/questions/2260/proof-that-1234-cdotsn-fracn-timesn12">formula for the sum of the first <span class="math inline">\(n\)</span> natural numbers</a>… Is Python able to help us here on its own?</p>
<div id="d7b57574-1367-4fab-a8ea-bff01b658292" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:06.688713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:06.688532Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:06.691324Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:06.690906Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:06.688698Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sum_up_to(n):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(<span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e8c588e7-e208-4781-8372-ec9ed8cc48fa" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:06.862551Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:06.862360Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:06.868733Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:06.868267Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:06.862536Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sum_df <span class="op">=</span> pd.DataFrame({<span class="st">'n'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">7</span>))})</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sum_df[<span class="st">'sum_1_to_n'</span>] <span class="op">=</span> sum_df[<span class="st">'n'</span>].<span class="bu">apply</span>(sum_up_to)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sum_df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sum_1_to_n</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>10</td>
<td>15</td>
<td>21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>One option would be to stare at this and try to figure out the pattern until we remember… Which is fine but, my brain is too tired to do that, which is why I wanted the computer to do it for me in the first place! Instead, let’s let <code>SymPy</code> try it:</p>
<div id="52ea5b33-a0a4-4a0b-9903-00303c386a1a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:07.422655Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:07.422402Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:07.725721Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:07.725125Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:07.422637Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> expand, oo, plot, simplify, symbols, Eq, Rational, Sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cb33d795-f690-46fa-b8b1-5f31e82eed80" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:07.726870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:07.726513Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:07.731989Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:07.731545Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:07.726841Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> symbols(<span class="st">'i'</span>, integer<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> symbols(<span class="st">'n'</span>, integer<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>my_sum <span class="op">=</span> Sum(i, (i, <span class="dv">1</span>, n))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>my_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="15">
<p><span class="math inline">\(\displaystyle \sum_{i=1}^{n} i\)</span></p>
</div>
</div>
<p>This is the thing we’re trying to remember the formula for… so let’s as <code>SymPy</code> to <code>.doit()</code>!</p>
<div id="fc2fd8f6-e0a0-4924-81dd-a71673499771" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:07.930973Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:07.930755Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:07.960192Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:07.959729Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:07.930958Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>my_result <span class="op">=</span> my_sum.doit()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>my_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="16">
<p><span class="math inline">\(\displaystyle \frac{n^{2}}{2} + \frac{n}{2}\)</span></p>
</div>
</div>
<p>…Already very cool, but we can get it in an even more familiar form by using <code>simplify()</code> as well:</p>
<div id="0b995a5b-1f00-44b1-b9ca-82f199a0a21d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:08.303103Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:08.302796Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:08.401246Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:08.400781Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:08.303078Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>simplify(my_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="17">
<p><span class="math inline">\(\displaystyle \frac{n \left(n + 1\right)}{2}\)</span></p>
</div>
</div>
<p>And we can ask it to derive exact, closed-form solutions for a bunch of other things too! For now, we can try sums of squares…</p>
<div id="775c70c2-1d61-4aa0-aaf7-f8ef09c50b01" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:08.650822Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:08.650533Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:08.672611Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:08.672154Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:08.650797Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>simplify(Sum(i<span class="op">**</span><span class="dv">2</span>, (i, <span class="dv">1</span>, n)).doit())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="18">
<p><span class="math inline">\(\displaystyle \frac{n \left(2 n^{2} + 3 n + 1\right)}{6}\)</span></p>
</div>
</div>
<p>Or the sum of a <a href="https://en.wikipedia.org/wiki/Geometric_series">geometric series</a> <span class="math inline">\(\sum_{i=1}^{\infty}ar^i\)</span>…</p>
<div id="154fe893-43d5-4d90-a680-377cec850086" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:08.991017Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:08.990825Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:09.126106Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:09.125730Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:08.991002Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> symbols(<span class="st">'a'</span>, nonnegative<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> symbols(<span class="st">'r'</span>, nonnegative<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>my_geo_sum <span class="op">=</span> Sum(a <span class="op">*</span> (r <span class="op">**</span> i), (i, <span class="dv">0</span>, oo))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>my_geo_result <span class="op">=</span> my_geo_sum.doit()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>my_geo_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="19">
<p><span class="math inline">\(\displaystyle a \left(\begin{cases} \frac{1}{1 - r} &amp; \text{for}\: r &lt; 1 \\\sum_{i=0}^{\infty} r^{i} &amp; \text{otherwise} \end{cases}\right)\)</span></p>
</div>
</div>
<p>And now that we have the formula, we could plug in a specific value for <span class="math inline">\(r\)</span> as well (here <span class="math inline">\(r = \frac{1}{5}\)</span>):</p>
<div id="c3df5f6c-25a0-4d42-9f67-b72c2ba70d37" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:09.330900Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:09.330682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:09.335524Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:09.335077Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:09.330882Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>my_geo_result.subs(r, Rational(<span class="dv">1</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="20">
<p><span class="math inline">\(\displaystyle \frac{5 a}{4}\)</span></p>
</div>
</div>
<p>Now we can import from the <code>sympy.stats</code> module, and compute exact values for the probabilities of each possible round result!</p>
<div id="dc5d3a73-7008-4130-8cc9-311e83ab0fc8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:09.687002Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:09.686689Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:09.710577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:09.710131Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:09.686976Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy.stats <span class="im">import</span> P, E, density, Bernoulli, DiscreteUniform</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Defining a sequence of i.i.d. RVs in <code>SymPy</code> is a bit tough in general (meaning, for example, it’d be tough to get it to prove the Central Limit Theorem), but, for simple cases like this where we’re summing up a finite number of coin flips, the following works!</p>
<p>We’ll use <code>Z</code> to represent the sum of the 13 coin flips, or in other words, the <strong>number of heads</strong> in a round of Elden Coin, now modeled <strong>exactly</strong> (without rounding or approximations), rather than simulated:</p>
<div id="3a067134-5343-4380-a1e7-63d20e5f05ae" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:10.047171Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:10.046713Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:10.053592Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:10.053142Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:10.047154Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>coins <span class="op">=</span> [Bernoulli(<span class="ss">f'X</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, p<span class="op">=</span>Rational(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, Game.flips_per_round)]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> <span class="bu">sum</span>(coins)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="22">
<p><span class="math inline">\(\displaystyle X_{0} + X_{1} + X_{10} + X_{11} + X_{12} + X_{2} + X_{3} + X_{4} + X_{5} + X_{6} + X_{7} + X_{8} + X_{9}\)</span></p>
</div>
</div>
<p>We can use the <code>E()</code> function imported above to get the exact <strong>expected value</strong> of the sum of 13 coin flips:</p>
<div id="4fbf0ecc-62b0-4fc2-b47c-b919c9f2cd87" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:10.397110Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:10.396799Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:10.406802Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:10.406376Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:10.397085Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>E(Z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="23">
<p><span class="math inline">\(\displaystyle \frac{13}{2}\)</span></p>
</div>
</div>
<p>And then the <code>P()</code> function to compute <strong>probabilities</strong>. For example, we can use Python’s built-in <strong>inequality</strong> operator <code>&gt;</code> in this case to find the thing we’re looking for: the game is fair if <span class="math inline">\(\Pr(Z &gt; 6)\)</span> is exactly <span class="math inline">\(1/2\)</span>:</p>
<div id="50c1424d-f770-4021-a537-b294c95d7255" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:10.788355Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:10.788141Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:16.969712Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:16.969178Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:10.788340Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>P(Z <span class="op">&gt;</span> Game.win_cutoff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="24">
<p><span class="math inline">\(\displaystyle \frac{1}{2}\)</span></p>
</div>
</div>
<p>As a warning if you decide to use <code>SymPy</code> for other stuff, though: it does <strong>not</strong> work well with Python’s equality operator <code>==</code>! For example, if you want to find the probability of a dice roll coming up 5, you might think of the following:</p>
<div id="77242cf5-0f59-4895-8f44-25d420fe10b5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:16.970706Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:16.970536Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:16.974537Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:16.974074Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:16.970690Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> DiscreteUniform(<span class="st">'D'</span>, <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">7</span>)))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>P(D <span class="op">==</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="25">
<p><span class="math inline">\(\displaystyle 0\)</span></p>
</div>
</div>
<p>Awful… 😵 Instead, we have to import <strong><code>SymPy</code>’s symbolic version of <code>==</code></strong>, namely, the equality function <code>Eq()</code>. If we use this instead of <code>==</code>, we’ll (thankfully) get the expected result!</p>
<div id="b66a2c91-e6fa-4ecd-9b6b-3d2c0f095ed5" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:16.975160Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:16.975004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:16.982211Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:16.981783Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:16.975146Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>P(Eq(D, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="26">
<p><span class="math inline">\(\displaystyle \frac{1}{6}\)</span></p>
</div>
</div>
<p>Ok! Now that you have a feel for <code>SymPy</code>, as a final helpful use for it here let’s derive the <strong>exact</strong> probability values for the different outcomes of a round of Elden Coin. For that, we can use <code>SymPy</code>’s <code>density()</code> function on a Random Variable, in this case on <span class="math inline">\(Z\)</span>:</p>
<div id="55c406a6-8f4c-4e8f-9fc3-fb0da0fdb166" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:16.983339Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:16.983179Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:21.237456Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:21.236948Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:16.983324Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pmf_Z <span class="op">=</span> density(Z)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>pmf_Z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>{0: 1/8192,
 1: 13/8192,
 2: 39/4096,
 3: 143/4096,
 4: 715/8192,
 5: 1287/8192,
 6: 429/2048,
 7: 429/2048,
 8: 1287/8192,
 9: 715/8192,
 10: 143/4096,
 11: 39/4096,
 12: 13/8192,
 13: 1/8192}</code></pre>
</div>
</div>
<p>And then, for easier viewing/plotting, we can form a Pandas <code>DataFrame</code> from these values:</p>
<div id="f99f6410-ee29-43f1-8f7e-57f0e5038a9a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:21.238292Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:21.238125Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:21.248339Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:21.247904Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:21.238277Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Z_df <span class="op">=</span> pd.DataFrame({<span class="st">'X'</span>:pmf_Z.keys(), <span class="st">'Pr(X)'</span>:pmf_Z.values()})</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Z_df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">X</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pr(X)</td>
<td>1/8192</td>
<td>13/8192</td>
<td>39/4096</td>
<td>143/4096</td>
<td>715/8192</td>
<td>1287/8192</td>
<td>429/2048</td>
<td>429/2048</td>
<td>1287/8192</td>
<td>715/8192</td>
<td>143/4096</td>
<td>39/4096</td>
<td>13/8192</td>
<td>1/8192</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="b29759fa-1473-4421-91f1-a15fd151bd94" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:21.249043Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:21.248878Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:21.358918Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:21.358454Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:21.249028Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>,<span class="fl">2.25</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ax.stem(<span class="st">"X"</span>, <span class="st">"Pr(X)"</span>, data<span class="op">=</span>Z_df, basefmt<span class="op">=</span><span class="st">'grey'</span>)<span class="op">;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Exact Values of Distribution"</span>)<span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Num Heads"</span>)<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Probability"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.grid(False);</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_facecolor('white');</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Sadly though, if you’re like me and you prefer <code>seaborn</code> to “base” <code>matplotlib</code>, <code>seaborn</code> doesn’t work well with the exact-numeric-value format of <code>SymPy</code> for fractions. So, for <code>seaborn</code> plotting you’ll have to convert to (non-exact) Python <code>float</code> values. But still, you’ll be plotting the closest possible <code>float</code> approximation to the true values!</p>
<div id="9c4fac26-271c-44a0-889f-caf2e0ef7427" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:21.359597Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:21.359413Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:21.369812Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:21.369354Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:21.359582Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>approx_df <span class="op">=</span> Z_df.copy()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>approx_df[<span class="st">'X'</span>] <span class="op">=</span> approx_df[<span class="st">'X'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>approx_df[<span class="st">'Pr(X)'</span>] <span class="op">=</span> approx_df[<span class="st">'Pr(X)'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>approx_df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">X</td>
<td>0.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>3.000000</td>
<td>4.00000</td>
<td>5.000000</td>
<td>6.000000</td>
<td>7.000000</td>
<td>8.000000</td>
<td>9.00000</td>
<td>10.000000</td>
<td>11.000000</td>
<td>12.000000</td>
<td>13.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pr(X)</td>
<td>0.000122</td>
<td>0.001587</td>
<td>0.009521</td>
<td>0.034912</td>
<td>0.08728</td>
<td>0.157104</td>
<td>0.209473</td>
<td>0.209473</td>
<td>0.157104</td>
<td>0.08728</td>
<td>0.034912</td>
<td>0.009521</td>
<td>0.001587</td>
<td>0.000122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="8b31d9f9-d850-44c0-a01a-056d068b1ecd" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:21.370405Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:21.370253Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:21.520875Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:21.520388Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:21.370391Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>,<span class="fl">2.25</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"X"</span>, y<span class="op">=</span><span class="st">"Pr(X)"</span>, data<span class="op">=</span>approx_df,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, alpha<span class="op">=</span><span class="fl">0.75</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"(Approximately-Exact) Values of Distribution"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.grid(False);</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_facecolor('white');</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-1.4-simulating-many-rounds" class="level3">
<h3 class="anchored" data-anchor-id="part-1.4-simulating-many-rounds">[Part 1.4] Simulating Many Rounds</h3>
<p>Now that we’ve convinced ourselves, both via simulation and exact-math, that a single round is fair, let’s move to simulating <strong>matches</strong>, comprised of 50 rounds! This is what we really care about, since it will tell us the <strong>range</strong> our winnings/losings might take on at the end of a full match.</p>
<p>The functions in the following cell carry out <strong>simulations</strong> at more coarse-grained levels than an individual round:</p>
<p><strong><code>sim_match(p)</code></strong> simulates a 50-round match and produces a Pandas <code>DataFrame</code> with the results:</p>
<ul>
<li><code>t</code> reprsents the round number (We add a special <span class="math inline">\(t = 0\)</span> “round” to mark the fact that we start with $0 at the beginning of the game, which will make the plots below more easy to read)</li>
<li><code>num_heads</code> represents the number of heads at round <code>t</code></li>
<li><code>money_change</code> is either <span class="math inline">\(-1\)</span> or <span class="math inline">\(1\)</span>: <span class="math inline">\(-1\)</span> if <code>num_heads</code> was less than 6, and <span class="math inline">\(1\)</span> otherwise, representing the net change in your money at the end of the round</li>
<li><code>money_at_round_end</code> represents the cumulative sum of <code>money_change</code> from round to round, so that at any round this contains the current overall winnings/losings relative to the 0 € starting point at <span class="math inline">\(t = 0\)</span></li>
</ul>
<p><strong><code>sim_outcome(p)</code></strong> allows us to get a sense for the <strong>ranges</strong> of values that can come out of a game, by simulating <code>MyGlobals.matches_to_sim</code> matches, and returning two Pandas <code>DataFrame</code>s giving us different pieces of information:</p>
<ul>
<li>In <code>final_df</code>, each row represents a single <strong>round</strong> within one of the simulated matches. We can use this to track the <strong>trajectory</strong> of money over the course of a match, and then, since we’re simulating <strong>many</strong> matches, we’ll in fact get a <strong>distribution over trajectories</strong>, which will help us visualize our expectations about how much money we may win or lose in a given match.</li>
<li>In <code>end_df</code>, each row represents the <strong>final round</strong> of a simulated match. As we’ll see in the plots below, this allows us to visualize the <strong>distribution over final winnings/losings we can expect to see</strong> for a given Elden Coin.</li>
</ul>
<p>Finally, <strong><code>get_result_label(money_at_end)</code></strong> is just a helper function for <code>sim_outcome(p)</code>: it allows us to “map” the <code>money_at_round_end</code> values from <code>sim_match()</code> to a three-level Random Variable called <code>result</code>, which will have value:</p>
<ul>
<li><code>"Gained Money"</code> if we ended the match with more money than we started with,</li>
<li><code>"Lost Money"</code> if we ended the match with less money than we started with, and</li>
<li><code>"Broke Even"</code> if we ended the match with exactly the same amount of money that we started with.</li>
</ul>
<div id="c2e4b867-ad84-4cf4-965d-9dd67d5307cf" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:21.521563Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:21.521381Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:23.244352Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:23.243841Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:21.521547Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sim_match(p):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    round_outcomes <span class="op">=</span> rng.binomial(n<span class="op">=</span>Game.flips_per_round, p<span class="op">=</span>p, size<span class="op">=</span>Game.rounds_per_match)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    match_df <span class="op">=</span> pd.DataFrame({<span class="st">'t'</span>: <span class="bu">range</span>(<span class="dv">1</span>,Game.rounds_per_match<span class="op">+</span><span class="dv">1</span>), <span class="st">'num_heads'</span>: round_outcomes})</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    match_df[<span class="st">'money_change'</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (match_df[<span class="st">'num_heads'</span>] <span class="op">&gt;</span> Game.win_cutoff)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    match_df[<span class="st">'money_at_round_end'</span>] <span class="op">=</span> match_df[<span class="st">'money_change'</span>].cumsum()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    t0_df <span class="op">=</span> pd.DataFrame({<span class="st">'t'</span>:[<span class="dv">0</span>],<span class="st">'money_at_round_end'</span>:[<span class="dv">0</span>],<span class="st">'money_change'</span>:[<span class="dv">0</span>]})</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    match_df <span class="op">=</span> pd.concat([t0_df, match_df])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(match_df)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>result_order <span class="op">=</span> [<span class="st">'Lost Money'</span>, <span class="st">'Broke Even'</span>, <span class="st">'Gained Money'</span>]</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_result_label(money_at_end):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> money_at_end <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Gained Money"</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> money_at_end <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Lost Money"</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Broke Even"</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sim_outcome(p):  </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    all_match_dfs <span class="op">=</span> []</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> <span class="bu">range</span>(MyGlobals.matches_to_sim):</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        match_df <span class="op">=</span> sim_match(p)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        match_df[<span class="st">'match_num'</span>] <span class="op">=</span> m</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        all_match_dfs.append(match_df)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All the data</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> pd.concat(all_match_dfs)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    final_df.insert(<span class="dv">0</span>, <span class="st">'match_num'</span>, final_df.pop(<span class="st">'match_num'</span>))</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    final_df[<span class="st">'params'</span>] <span class="op">=</span> <span class="ss">f"p = </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Just the last round money_at_end</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    end_df <span class="op">=</span> final_df[final_df[<span class="st">'t'</span>] <span class="op">==</span> Game.rounds_per_match].copy()</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    end_df <span class="op">=</span> end_df[[<span class="st">'match_num'</span>,<span class="st">'t'</span>,<span class="st">'money_at_round_end'</span>]]</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    end_df[<span class="st">'result'</span>] <span class="op">=</span> end_df[<span class="st">'money_at_round_end'</span>].<span class="bu">apply</span>(get_result_label)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    end_df[<span class="st">'result'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        end_df[<span class="st">'result'</span>],</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>result_order</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    end_df[<span class="st">'params'</span>] <span class="op">=</span> <span class="ss">f"p = </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df, end_df</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>fair_final_df, fair_end_df <span class="op">=</span> sim_outcome(<span class="fl">0.5</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"fair_final_df:"</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>display(fair_final_df.head())</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"fair_end_df:"</span>)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>display(fair_end_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fair_final_df:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">match_num</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">params</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>p = 0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>8.0</td>
<td>p = 0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>-1</td>
<td>6.0</td>
<td>p = 0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>9.0</td>
<td>p = 0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>8.0</td>
<td>p = 0.5</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>fair_end_df:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">match_num</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">result</th>
<th data-quarto-table-cell-role="th">params</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>0</td>
<td>50</td>
<td>2</td>
<td>Gained Money</td>
<td>p = 0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>1</td>
<td>50</td>
<td>-10</td>
<td>Lost Money</td>
<td>p = 0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>2</td>
<td>50</td>
<td>-4</td>
<td>Lost Money</td>
<td>p = 0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>3</td>
<td>50</td>
<td>16</td>
<td>Gained Money</td>
<td>p = 0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>4</td>
<td>50</td>
<td>-2</td>
<td>Lost Money</td>
<td>p = 0.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With <code>fair_final_df</code> and <code>fair_end_df</code> now ready for use, we can plot the range of <strong>trajectories</strong> (from <span class="math inline">\(t = 0\)</span> to <span class="math inline">\(t = 50\)</span>) that a match might exhibit, as well as the distribution of <strong>final winnings/losings</strong> that we may obtain at the end of a match under the specified Elden Coin value of <span class="math inline">\(p\)</span>.</p>
<p>For now we’ll plot what matches with a <strong>fair coin</strong> might look like, but in the next section we’ll produce the same kind of plot for a <strong>biased coin</strong>!</p>
<p>The most straightforward way to visualize the trajectories is probably just to plot <strong>every</strong> “path” through the game space, with a low <code>alpha</code> value so that the more-frequent paths appear as a darker orange:</p>
<div id="487f1db2-3bc5-44e4-9ef2-7de47fd441ab" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:23.245986Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:23.245796Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:24.372226Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:24.371576Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:23.245970Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_trajectories(final_df, end_df, suptitle, custom_ylim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> custom_ylim <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="fl">4.5</span>)<span class="op">;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="fl">4.5</span>, ylim<span class="op">=</span>custom_ylim)<span class="op">;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    fair_trajectory_plot <span class="op">=</span> sns.lineplot(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, data<span class="op">=</span>final_df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        units<span class="op">=</span><span class="st">'match_num'</span>, estimator<span class="op">=</span><span class="va">None</span>, alpha<span class="op">=</span><span class="fl">0.02</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Breaking-even line</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    grid.refline(</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'solid'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Breaking Even"</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the median line in dashed black</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, <span class="co"># hue="source",</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>final_df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">"Median"</span>,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># errorbar=('pi',90),</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dashed'</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.15</span>),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And mean line in dotted black</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, <span class="co"># hue="source",</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>final_df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">"Mean"</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'mean'</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># errorbar=('pi',90),</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dotted'</span>,</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.15</span>),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_x.remove()<span class="op">;</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.axhline(</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>end_df[<span class="st">'money_at_round_end'</span>].mean(),</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'#e69f00'</span>, lw<span class="op">=</span><span class="dv">2</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Marginal axis</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    winnings_plot <span class="op">=</span> sns.histplot(</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"money_at_round_end"</span>, data<span class="op">=</span>end_df,</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>grid.ax_marg_y,</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>        discrete<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dashed line on margin for median</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.axhline(</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>end_df[<span class="st">'money_at_round_end'</span>].median(), color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dotted line on margin for mean</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.axhline(</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>end_df[<span class="st">'money_at_round_end'</span>].mean(), color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.set_title(<span class="st">"Round Level"</span>)<span class="op">;</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.set_title(<span class="st">"Match Level"</span>)<span class="op">;</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    grid.fig.set_figwidth(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    grid.fig.suptitle(suptitle)<span class="op">;</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.set_ylabel(<span class="st">"Money at Round End"</span>)<span class="op">;</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.legend(loc<span class="op">=</span><span class="st">"upper left"</span>)<span class="op">;</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>plot_trajectories(</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>    fair_final_df, fair_end_df,</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>    suptitle<span class="op">=</span><span class="st">"Trajectories and Winnings for 1000 Matches, p = 0.5"</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Though this plot is helpful for seeing the “emergent” distribution of winnings relative to the underlying coin flips, it also makes it difficult to see the median or mean pathways/winnings – these lines will be difficult to see in this case either way, because they’re close to 0 throughout, but being able to see them a bit better will be helpful when we move to biased coins.</p>
<p>So, as an alternative that we’ll use from here on out, we can just plot a series of lighter “bands” around the median pathway, containing (from darkest to lightest) the middle 50, 90, and 99 percentiles of <code>money_at_round_end</code> across all simulations (note that the band containing the middle 99 percentiles may be cut off, since it may reach extreme negative and positive values when we simulate many matches!)</p>
<div id="21930018-59c6-4dc3-966b-466a2861f145" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:24.373042Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:24.372868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.061826Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.061295Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:24.373026Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_trajectory_bands(final_df, end_df, suptitle, custom_ylim<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> custom_ylim <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        fair_grid_var <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="dv">5</span>, ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">22</span>,<span class="dv">22</span>))<span class="op">;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        fair_grid_var <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Don't need marginal plot on x-axis</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_marg_x.remove()<span class="op">;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This ensures that the legend doesn't include params 3 different times</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    ftemp_df <span class="op">=</span> final_df.copy()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    ftemp_df[<span class="st">'params'</span>] <span class="op">=</span> <span class="st">"_"</span> <span class="op">+</span> ftemp_df[<span class="st">'params'</span>]</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Band containing the middle 100 percentiles of all trajectories</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    full_range_plot <span class="op">=</span> sns.lineplot(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, hue<span class="op">=</span><span class="st">"params"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>ftemp_df, ax<span class="op">=</span>fair_grid_var.ax_joint,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># color=cb_palette[0],</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">99</span>),</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.125</span>),</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Band containing middle 90 percentiles</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, hue<span class="op">=</span><span class="st">"params"</span>,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>ftemp_df, ax<span class="op">=</span>fair_grid_var.ax_joint,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># color=cb_palette[0],</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">90</span>),</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.25</span>),</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Band containing middle 50 percentiles</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, hue<span class="op">=</span><span class="st">"params"</span>,</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>ftemp_df, ax<span class="op">=</span>fair_grid_var.ax_joint,</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># color=cb_palette[0],</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">50</span>),</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median trajectory as dashed black line</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, label<span class="op">=</span><span class="st">"Median of Simulated Rounds"</span>,</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>ftemp_df, ax<span class="op">=</span>fair_grid_var.ax_joint,</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dashed'</span>,</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean trajectory as dotted black line</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, label<span class="op">=</span><span class="st">"Mean of Simulated Rounds"</span>,</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>ftemp_df, ax<span class="op">=</span>fair_grid_var.ax_joint,</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dotted'</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'mean'</span>,</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Refline links joint and marginal plots</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.refline(</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'solid'</span>, label<span class="op">=</span><span class="st">'Breaking Even'</span>, alpha<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_joint.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)<span class="op">;</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">### Marginal plot</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>    margin_kde <span class="op">=</span> sns.histplot(</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"money_at_round_end"</span>, data<span class="op">=</span>end_df,</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>fair_grid_var.ax_marg_y,</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>        discrete<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># fill=True,</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    margin_kde <span class="op">=</span> sns.kdeplot(</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"money_at_round_end"</span>, data<span class="op">=</span>end_df,</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>fair_grid_var.ax_marg_y,</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dashed line on margin for median</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_marg_y.axhline(</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>end_df[<span class="st">'money_at_round_end'</span>].median(), color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dotted line on margin for mean</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_marg_y.axhline(</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>end_df[<span class="st">'money_at_round_end'</span>].mean(), color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.fig.suptitle(suptitle)<span class="op">;</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_joint.set_ylabel(<span class="st">"Money at Round End"</span>)<span class="op">;</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_joint.set_title(<span class="st">"Round Level"</span>)<span class="op">;</span></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.ax_marg_y.set_title(<span class="st">"Match Level"</span>)<span class="op">;</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>    fair_grid_var.fig.set_figwidth(<span class="fl">9.5</span>)<span class="op">;</span></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fair_grid_var</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>plot_trajectory_bands(</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>    fair_final_df, fair_end_df, custom_ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">25</span>, <span class="dv">25</span>),</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>    suptitle<span class="op">=</span><span class="st">"Distribution of Trajectories and Winnings for 1000 Matches, p = 0.5"</span></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And, like we did with Win vs.&nbsp;Loss for a single <strong>round</strong>, here we can more simply plot the three outcomes we’ve defined at the match level:</p>
<div id="20594fec-7a27-4dfb-ab27-b1da96164626" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.062615Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.062419Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.069909Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.069416Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.062598Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fair_result_df <span class="op">=</span> fair_end_df[<span class="st">'result'</span>].value_counts(sort<span class="op">=</span><span class="va">False</span>, normalize<span class="op">=</span><span class="va">True</span>).to_frame().reset_index()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fair_result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">result</th>
<th data-quarto-table-cell-role="th">proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lost Money</td>
<td>0.440</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Broke Even</td>
<td>0.117</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gained Money</td>
<td>0.443</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="199b9eec-3f92-4f19-a6b5-15b588a5088c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.070577Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.070391Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.337137Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.336635Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.070562Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"result"</span>, y<span class="op">=</span><span class="st">"proportion"</span>, data<span class="op">=</span>fair_result_df,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Outcomes for 1000 Matches, p = 0.5"</span>)<span class="op">;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="part-2-simulating-the-unlockable-sheisty-coin" class="level2">
<h2 class="anchored" data-anchor-id="part-2-simulating-the-unlockable-sheisty-coin">[Part 2] Simulating the Unlockable <em>Sheisty Coin</em></h2>
<p>The only problem is… in the new Season 2 of Elden Coin, the company who makes the game (ThumbSoft) has added a new <strong>powerup shop</strong>, which means that now your friend <span class="math inline">\(B\)</span> may have used their Elden Coin earnings to buy a powerup which secretly <strong>biases their Elden Coin</strong> in their favor, turning it into a new evolved form, the <strong><a href="https://www.oed.com/dictionary/sheisty_adj">Shiesty</a> Coin</strong>. When someone buys this powerup, it adds a randomly-generated amount of bias to their coin, so that its new probability of Heads is some value (uniformly) between <span class="math inline">\(0.4\)</span> and <span class="math inline">\(0.5\)</span>.</p>
<p>So, this means there are two new “layers” of uncertainty in a sense:</p>
<ul>
<li>You don’t know whether or not your friend has a Sheisty Coin at all, and</li>
<li>You don’t know how much bias was added to their coin if they did purchase the upgrade.</li>
</ul>
<p>The eventual goal will be to use <code>PyMC</code> to <strong>model</strong> this uncertainty explicitly, allowing you to make optimal gameplay choices!</p>
<p>For now, let’s simulate what rounds may look like, then what match-level trajectories and winnings may look like, under a specific biased-coin scenario.</p>
<section id="part-2.1-simulating-biased-round-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="part-2.1-simulating-biased-round-outcomes">[Part 2.1] Simulating Biased <em>Round</em> Outcomes</h3>
<p>The following cells generate and then plot a distribution of simulated <strong>round outcomes</strong> for a Sheisty Coin biased exactly in the middle of the possible range, with <span class="math inline">\(p = 0.45\)</span>:</p>
<div id="3790f42d-672f-4cc6-a7cc-5301d2dbc274" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.337864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.337682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.340285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.339830Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.337835Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p_biased <span class="op">=</span> <span class="fl">0.45</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="07c4fba4-039b-4310-9696-deff90b228da" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.340912Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.340746Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.375957Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.375506Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.340897Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>biased_sim_result <span class="op">=</span> [sim_round(p_biased) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(MyGlobals.rounds_to_sim)]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>biased_sim_df <span class="op">=</span> pd.DataFrame({<span class="st">'num_heads'</span>: biased_sim_result, <span class="st">'params'</span>: <span class="st">'p = 0.45'</span>})</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>biased_sim_df[<span class="st">'win'</span>] <span class="op">=</span> biased_sim_df[<span class="st">'num_heads'</span>] <span class="op">&gt;</span> Game.win_cutoff</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>biased_count_df <span class="op">=</span> get_counts(biased_sim_df)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>biased_count_df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">num_heads</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">count</td>
<td>8</td>
<td>44</td>
<td>242</td>
<td>665</td>
<td>1353</td>
<td>1983</td>
<td>2177</td>
<td>1699</td>
<td>1150</td>
<td>479</td>
<td>160</td>
<td>38</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">win</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pr(num_heads)</td>
<td>0.0008</td>
<td>0.0044</td>
<td>0.0242</td>
<td>0.0665</td>
<td>0.1353</td>
<td>0.1983</td>
<td>0.2177</td>
<td>0.1699</td>
<td>0.115</td>
<td>0.0479</td>
<td>0.016</td>
<td>0.0038</td>
<td>0.0002</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="d304c778-92b1-4d09-ad46-c9b08d871ec9" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.376611Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.376449Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:25.548247Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:25.547765Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.376596Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>,<span class="fl">2.25</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.barplot(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"num_heads"</span>, y<span class="op">=</span><span class="st">"Pr(num_heads)"</span>, hue<span class="op">=</span><span class="st">"win"</span>, data<span class="op">=</span>biased_count_df,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="fl">6.5</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"N = </span><span class="sc">{</span><span class="bu">len</span>(biased_sim_result)<span class="sc">}</span><span class="ss"> Simulated Rounds, p = 0.5"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And we can also plot the kernel densities of the two <code>num_heads</code> distributions, to compare the biased and fair outcomes visually:</p>
<div id="5fbff650-b415-4f21-aacf-5ccd4d81cfeb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:25.549073Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:25.548905Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:26.051159Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:26.050670Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:25.549058Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>combined_sim_df <span class="op">=</span> pd.concat([fair_sim_df, biased_sim_df])</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>combined_sim_df</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram (confusing imo)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">4.5</span>,<span class="fl">2.5</span>))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"num_heads"</span>, hue<span class="op">=</span><span class="st">"params"</span>, data<span class="op">=</span>combined_sim_df, ax<span class="op">=</span>ax1,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    discrete<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill=True, bw_adjust=2</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>ax1.axvline(x<span class="op">=</span><span class="fl">6.5</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># KDE Plot (more helpful imo!)</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">4.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"num_heads"</span>, hue<span class="op">=</span><span class="st">"params"</span>, data<span class="op">=</span>combined_sim_df, ax<span class="op">=</span>ax2,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>, bw_adjust<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>ax12 <span class="op">=</span> ax1 <span class="op">|</span> ax2</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>ax12.set_suptitle(<span class="ss">f"N = </span><span class="sc">{</span><span class="bu">len</span>(biased_sim_result)<span class="sc">}</span><span class="ss"> Simulated Rounds"</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>ax12.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-2.2-simulating-biased-match-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="part-2.2-simulating-biased-match-outcomes">[Part 2.2] Simulating Biased <em>Match</em> Outcomes</h3>
<p>The above plot shows the bias relative to a single <em>round</em> of the game, but let’s also generate a plot to see what this looks like when we run <strong>50 matches</strong>. We’ll plot both the <span class="math inline">\(p = 0.5\)</span> and <span class="math inline">\(p = 0.45\)</span> trajectories so you can get a comparative sense:</p>
<div id="89cd3ffd-7a8e-4674-88b8-280927ee5432" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:26.052139Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:26.051973Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:27.655571Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:27.655061Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:26.052123Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>biased_final_df, biased_end_df <span class="op">=</span> sim_outcome(p_biased)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"biased_final_df:"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>display(biased_final_df.head())</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"biased_end_df:"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>display(biased_end_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>biased_final_df:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">match_num</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">params</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>p = 0.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>-1</td>
<td>-1</td>
<td>5.0</td>
<td>p = 0.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>11.0</td>
<td>p = 0.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>3</td>
<td>-1</td>
<td>-1</td>
<td>5.0</td>
<td>p = 0.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>1</td>
<td>7.0</td>
<td>p = 0.45</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>biased_end_df:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">match_num</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">result</th>
<th data-quarto-table-cell-role="th">params</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>0</td>
<td>50</td>
<td>-10</td>
<td>Lost Money</td>
<td>p = 0.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>1</td>
<td>50</td>
<td>-22</td>
<td>Lost Money</td>
<td>p = 0.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>2</td>
<td>50</td>
<td>-8</td>
<td>Lost Money</td>
<td>p = 0.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>3</td>
<td>50</td>
<td>-12</td>
<td>Lost Money</td>
<td>p = 0.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>4</td>
<td>50</td>
<td>-10</td>
<td>Lost Money</td>
<td>p = 0.45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="db79e0fb-b02f-4fcd-8180-6a8ea92c2af2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:27.656306Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:27.656135Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:28.975785Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:28.975276Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:27.656290Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plot_trajectories(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    biased_final_df, biased_end_df,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    suptitle<span class="op">=</span><span class="st">"Trajectories and Winnings for 1000 Matches, p = 0.45"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And then, if we plot just the mean amount of money at the end of each round, averaged across simulations, we can compare the two trajectories on the same plot:</p>
<div id="6762556c-d7a2-49c0-84d6-eb1acd4e76a2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:28.976563Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:28.976370Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:29.396766Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:29.396251Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:28.976547Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>combined_final_df <span class="op">=</span> pd.concat([fair_final_df, biased_final_df])</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>combined_end_df <span class="op">=</span> pd.concat([fair_end_df, biased_end_df])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>biased_grid <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="dv">5</span>, ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>biased_grid.refline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'solid'</span>, label<span class="op">=</span><span class="st">'Breaking Even'</span>)<span class="op">;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean lines</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, hue<span class="op">=</span><span class="st">"params"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>combined_final_df, ax<span class="op">=</span>biased_grid.ax_joint,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#errorbar=None,</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">50</span>),</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.15</span>),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>biased_grid.ax_marg_x.remove()<span class="op">;</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>biased_grid.refline(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>fair_end_df[<span class="st">'money_at_round_end'</span>].mean(),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>cb_palette[<span class="dv">0</span>], lw<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Expected Payoff (p = 0.5)'</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>biased_grid.refline(</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>biased_end_df[<span class="st">'money_at_round_end'</span>].mean(),</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>cb_palette[<span class="dv">1</span>], lw<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Expected Payoff (p = 0.45)'</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>biased_grid.ax_joint.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)<span class="op">;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.legend(['Breaking Even','Your Expected Payoff'], loc="left")</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"money_at_round_end"</span>, hue<span class="op">=</span><span class="st">"params"</span>, data<span class="op">=</span>combined_end_df,</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>biased_grid.ax_marg_y, fill<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stat='density',</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># discrete=True,</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># shrink=0.5,</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>biased_grid.ax_joint.set_ylabel(<span class="st">"Money at Round End"</span>)<span class="op">;</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>biased_grid.fig.set_figwidth(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And from this plot we can see how, the median trajectories begin to noticeably depart from about <span class="math inline">\(t = 5\)</span> onwards, and then even the <strong>intervals containing the middle 50%</strong> of end-of-round money amounts begin to separate from about <span class="math inline">\(t = 26\)</span> onwards.</p>
</section>
</section>
<section id="part-3-moving-to-pymc-modeling-the-season-2-dynamic" class="level2">
<h2 class="anchored" data-anchor-id="part-3-moving-to-pymc-modeling-the-season-2-dynamic">[Part 3] Moving to PyMC: Modeling the Season 2 Dynamic</h2>
<p>So far, it seems like playing your friend is a capital-B capital-D Bad Deal for you! Which raises the question…</p>
<section id="part-3.1-why-would-you-play-at-all" class="level3">
<h3 class="anchored" data-anchor-id="part-3.1-why-would-you-play-at-all">[Part 3.1] Why Would You Play At All?</h3>
<p>The short answer is that… this is not so far removed from the structure of e.g.&nbsp;a lottery, or just gambling in general: you get the thrill of the small chance of winning big, and meanwhile, if <span class="math inline">\(B\)</span> was for example a US state, they would get the revenue from their state lottery.</p>
<p>In <strong>Elden Coin</strong> specifically, though, the idea is that you can similarly <strong>win big</strong> if you beat someone who has a <strong>Sheisty Coin</strong>, because of a game mechanic that the developers released alongside the new powerup shop:</p>
<ul>
<li>If you beat someone <strong>without</strong> the coin, you get the “standard”, expected money amount given by the rules of the game. However,</li>
<li>If you beat someone <strong>with</strong> the Sheisty Coin, your winnings <strong>double!</strong></li>
</ul>
<p>With this final addition to the game rules, it’s getting a bit complicated to think through everything in our heads – and that’s exactly the reason why PyMC is so useful! It’s a tool for making “optimal” inferences in complex settings with tons of different sources of uncertainty occurring at different levels of analysis!<sup>[1]</sup></p>
<hr>
<p><small></small></p><small>
<ol type="1">
<li>Here, and throughout the class, the “optimality” of Bayesian inference is rooted pretty straightforwardly in De Finetti’s Theorem and its corollaries: If a person <span class="math inline">\(i\)</span> decides to update probabilities in the face of evidence using <strong>any criteria besides Bayes’ Rule</strong>, they are provably susceptible to what’s called a <a href="https://en.wikipedia.org/wiki/Dutch_book_theorems">Dutch Book scheme</a>, meaning that someone who <strong>is</strong> using Bayes’ Rule can construct a betting scheme that seems good to <span class="math inline">\(i\)</span> (meaning, when <span class="math inline">\(i\)</span> calculates their expected outcomes using their non-Bayesian probability-updating scheme), but will actually result in <span class="math inline">\(i\)</span> losing money in expectation.</li>
</ol>
</small><p><small></small></p>
</section>
<section id="part-3.2-modeling-prtextsfheads-mid-textsfsheisty" class="level3">
<h3 class="anchored" data-anchor-id="part-3.2-modeling-prtextsfheads-mid-textsfsheisty">[Part 3.2] Modeling <span class="math inline">\(\Pr(\textsf{Heads} \mid \textsf{Sheisty})\)</span></h3>
<p>At this point, though we could keep making our <code>sim_outcome()</code> function more and more complicated to adapt to these new dynamics… we have PyMC right there, a library which was created for carrying out optimal (Bayesian) inferences in probabilistic systems!</p>
<p>And specifically, since the whole point of this writeup is to introduce a standard <strong>Bayesian Workflow</strong>… this is where that starts! My hope is that you’ll see the benefit of having a full-on <strong>inference machine</strong> that can quickly produce the four distributions discussed in Week 6:</p>
<ol type="1">
<li>The <strong>Prior</strong> Distribution, which in this case incorporates:</li>
</ol>
<ul>
<li>The probability <span class="math inline">\(s \in [0, 1]\)</span> of <span class="math inline">\(B\)</span> having a Sheisty Coin and</li>
<li>The corresponding coin bias <span class="math inline">\(p \in [0.4, 0.5]\)</span></li>
</ul>
<ol start="2" type="1">
<li>The <strong>Prior Predictive</strong> Distribution, which gives us:</li>
</ol>
<ul>
<li>A distribution over <code>num_heads</code> <span class="math inline">\(\in \{0, 1, \ldots, 13\}\)</span>, as well as distributions over two quantities that can be derived from this:</li>
<li>A distribution over the binary value <code>win</code> <span class="math inline">\(\in \{0, 1\}\)</span>, and</li>
<li>A distribution over the <code>money_change</code> value <span class="math inline">\(\in \{-1, 1\}\)</span>.</li>
</ul>
<p>(Note how, since we’re building <code>num_rounds</code> into our model, PyMC will automatically generate <strong>50 separate round samples</strong> for each draw from this prior predictive distribution, so that we can quickly just sum up these 50 values to obtain a distribution over <strong>mach outcomes</strong> as well)</p>
<ol start="3" type="1">
<li><p>The <strong>Posterior</strong> Distribution, which gives us <strong>new</strong> distributions over the parameters <span class="math inline">\(s\)</span> and <span class="math inline">\(p\)</span>, representing the optimal <strong>updates</strong> of the Prior Distribution after observing a set of data. And lastly,</p></li>
<li><p>The <strong>Posterior Predictive</strong> Distribution, which we can use in the same way we used the <strong>Prior Predictive</strong> distribution, but in this case it will generate distributions over <code>num_heads</code>, <code>win</code>, and <code>money_change</code> <strong>in light of</strong> the updated values of <span class="math inline">\(s\)</span> and <span class="math inline">\(p\)</span>.</p></li>
</ol>
<p>So, let’s write out a model in PyMC that takes into account <strong>all</strong> of the possible sources of uncertainty that we want to model in this case:</p>
<div id="4ff567a4-e6a8-458f-be3f-93d953d4f5bf" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:29.398442Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:29.398244Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:29.401297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:29.400858Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:29.398408Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> S2Game:</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    flips_per_round <span class="op">=</span> <span class="dv">13</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    num_heads_range <span class="op">=</span> (<span class="dv">0</span>, flips_per_round)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    num_heads_support <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, flips_per_round <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    win_cutoff <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    rounds_per_match <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    bonus_multiplier <span class="op">=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b8871a46-5fad-4e56-b076-bc9c40006704" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:41:29.401952Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:41:29.401785Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:41:29.516948Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:41:29.516460Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:41:29.401938Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'t'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, Game.rounds_per_match <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> s2_model:</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    p_sheisty <span class="op">=</span> pm.Uniform(<span class="st">"p_sheisty"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    is_sheisty <span class="op">=</span> pm.Bernoulli(<span class="st">"is_sheisty"</span>, p<span class="op">=</span>p_sheisty)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    fair_p_heads <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    sheisty_p_heads <span class="op">=</span> pm.Uniform(<span class="st">"sheisty_p_heads"</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    p_heads <span class="op">=</span> pm.Deterministic(<span class="st">"p_heads"</span>, pm.math.switch(is_sheisty, sheisty_p_heads, fair_p_heads))</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The flips</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    num_heads <span class="op">=</span> pm.Binomial(<span class="st">"num_heads"</span>, n<span class="op">=</span>Game.flips_per_round, p<span class="op">=</span>p_heads, dims<span class="op">=</span><span class="st">'t'</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The round result</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    money_change <span class="op">=</span> pm.Deterministic(</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_change"</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(pm.math.gt(num_heads, Game.win_cutoff), <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The cumulative result</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    money_at_round_end <span class="op">=</span> pm.Deterministic(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_at_round_end"</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>        pm.math.cumsum(money_change, <span class="dv">0</span>),</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And the doubling-at-end if we win</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    money_w_bonus <span class="op">=</span> pm.Deterministic(</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_w_bonus"</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>            pm.math.gt(money_at_round_end, <span class="dv">0</span>),</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>            S2Game.bonus_multiplier <span class="op">*</span> money_at_round_end,</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>            money_at_round_end</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(s2_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-46-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-3.3-the-prior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="part-3.3-the-prior-distribution">[Part 3.3] The Prior Distribution</h3>
<div id="b3b0f128-e6a6-4627-a3b2-b4f921d3425c" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:17.725210Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:17.724940Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:18.573388Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:18.572896Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:17.725193Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s2_model:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    s2_prior_idata <span class="op">=</span> pm.sample_prior_predictive(draws<span class="op">=</span>MyGlobals.matches_to_sim, random_seed<span class="op">=</span><span class="dv">5650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling: [is_sheisty, num_heads, p_sheisty, sheisty_p_heads]</code></pre>
</div>
</div>
<div id="48ff072d-7907-44bf-8b3c-3ac7f3ce8380" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:19.447569Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:19.446709Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:19.466298Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:19.465840Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:19.447551Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>s2_prior_df <span class="op">=</span> s2_prior_idata.prior.to_dataframe().reset_index().drop(columns<span class="op">=</span><span class="st">'chain'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>s2_prior_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">draw</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">is_sheisty</th>
<th data-quarto-table-cell-role="th">p_heads</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">p_sheisty</th>
<th data-quarto-table-cell-role="th">sheisty_p_heads</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>6</td>
<td>1</td>
<td>0.432234</td>
<td>-1</td>
<td>-1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>6</td>
<td>1</td>
<td>0.432234</td>
<td>-2</td>
<td>-1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>-2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>3</td>
<td>7</td>
<td>1</td>
<td>0.432234</td>
<td>-1</td>
<td>1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>4</td>
<td>7</td>
<td>1</td>
<td>0.432234</td>
<td>0</td>
<td>1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>5</td>
<td>6</td>
<td>1</td>
<td>0.432234</td>
<td>-1</td>
<td>-1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="0df75b2b-9e55-40f6-8494-9f08b01a0b0e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:20.320947Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:20.320655Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:20.329577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:20.328893Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:20.320931Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>s2_prior_end_df <span class="op">=</span> s2_prior_df[s2_prior_df[<span class="st">'t'</span>] <span class="op">==</span> Game.rounds_per_match].copy()</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>s2_prior_end_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">draw</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">is_sheisty</th>
<th data-quarto-table-cell-role="th">p_heads</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">p_sheisty</th>
<th data-quarto-table-cell-role="th">sheisty_p_heads</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>0</td>
<td>50</td>
<td>5</td>
<td>1</td>
<td>0.432234</td>
<td>-24</td>
<td>-1</td>
<td>0.888773</td>
<td>0.432234</td>
<td>-24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>1</td>
<td>50</td>
<td>8</td>
<td>0</td>
<td>0.500000</td>
<td>10</td>
<td>1</td>
<td>0.027332</td>
<td>0.433957</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>2</td>
<td>50</td>
<td>5</td>
<td>0</td>
<td>0.500000</td>
<td>-10</td>
<td>-1</td>
<td>0.081197</td>
<td>0.407078</td>
<td>-10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199</td>
<td>3</td>
<td>50</td>
<td>5</td>
<td>0</td>
<td>0.500000</td>
<td>-6</td>
<td>-1</td>
<td>0.864813</td>
<td>0.400025</td>
<td>-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>4</td>
<td>50</td>
<td>7</td>
<td>1</td>
<td>0.412902</td>
<td>-22</td>
<td>1</td>
<td>0.871763</td>
<td>0.412902</td>
<td>-22</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="eccafc54-2033-41e4-8ee7-3be34c0d1160" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:21.459017Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:21.458693Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:21.582498Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:21.582080Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:21.458990Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"p_sheisty"</span>, data<span class="op">=</span>s2_prior_end_df, ax<span class="op">=</span>ax</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Prior Distribution of p_sheisty"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="38bb656c-8908-4e13-99b2-25fc0af9e006" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:22.172894Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:22.172699Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:22.293632Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:22.293220Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:22.172877Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"p_heads"</span>, data<span class="op">=</span>s2_prior_end_df, ax<span class="op">=</span>ax</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Prior Distribution of p_heads"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="95e4886d-f546-40af-9d05-8bfa84614e72" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:22.494758Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:22.494462Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:22.619073Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:22.618670Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:22.494731Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"is_sheisty"</span>, data<span class="op">=</span>s2_prior_end_df, ax<span class="op">=</span>ax</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Prior Distribution of is_sheisty"</span>)<span class="op">;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-3.3-the-prior-predictive-distribution" class="level3">
<h3 class="anchored" data-anchor-id="part-3.3-the-prior-predictive-distribution">[Part 3.3] The Prior <em>Predictive</em> Distribution</h3>
<p>Now, the vocabulary in this part is going to be a bit confusing at first:</p>
<ul>
<li>With the way <strong>we</strong> have defined the model parameters – <code>p_sheisty</code> and <code>p_heads</code> as parameters and then <code>num_heads</code> (as a vector) and <code>money final</code> (as a scalar) as outcomes – we <strong>do</strong> have a prior predictive distribution her, since we can obtain distributions over the outcomes before actually observing any data. However…</li>
<li>With the way <strong>PyMC</strong> defines paramters, we don’t “unlock” the prior-predictive or posterior-predictive distributions until we actually <strong>provide observed data</strong> to the model.</li>
</ul>
<p>So, what that means is, don’t be fooled by the PyMC terminology (which is for computational convenience – see e.g.&nbsp;<a href="https://discourse.pymc.io/t/why-is-a-posterior-created-in-pm-model-when-no-data-are-given/12009/6">this post</a> on their forum about it)! We’re going to use the <code>.prior</code> attribute of our inference data, but we’re using it to carry out a prior-predictive check in this part!<sup>[1]</sup></p>
<hr>
<p><small></small></p><small>
<ol type="1">
<li>I’m going to release a shorter writeup soon where we’ll supply the data to our <code>pm.Model()</code> right away, so that we’ll immediately have access to <code>.prior</code>, <code>.prior_predictive</code>, <code>.posterior</code>, and <code>.posterior_predictive</code>!</li>
</ol>
</small><p><small></small></p>
<p>First things first, we could infer just from a table of the means and medians of the two models that the bonus-money has had an interesting effect on our expected earnings:</p>
<div id="1ddbc49d-9f68-45af-9f17-6ebf829fe154" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:27.116971Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:27.116749Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:27.126087Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:27.125695Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:27.116955Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>s2_prior_money_df <span class="op">=</span> s2_prior_end_df[[<span class="st">'draw'</span>,<span class="st">'money_at_round_end'</span>,<span class="st">'money_w_bonus'</span>]].copy().melt(id_vars<span class="op">=</span><span class="st">"draw"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>s2_prior_money_df.groupby(<span class="st">'variable'</span>)[<span class="st">'value'</span>].agg([<span class="st">'mean'</span>,<span class="st">'median'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">median</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">money_at_round_end</td>
<td>-6.536</td>
<td>-6.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">money_w_bonus</td>
<td>0.792</td>
<td>-6.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Even though the medians are exactly the same, the <strong>means</strong> of the two variables now differ in an important way, with one above 0 and the other well below 0. To get a visual for why this happens, let’s plot two posterior-predictive distributions here, on the same axes, to see how the doubling-of-positive-winnings dynamic affects the distribution of outcomes (as well as the ultimate expected value!)</p>
<div id="85a6db13-3543-4327-b316-1c41533fcc10" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:27.897069Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:27.896757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:28.059479Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:28.058965Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:27.897044Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>prior_mean_money_nb <span class="op">=</span> s2_prior_end_df[<span class="st">'money_at_round_end'</span>].mean()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>prior_mean_money <span class="op">=</span> s2_prior_end_df[<span class="st">'money_w_bonus'</span>].mean()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">3.5</span>))<span class="op">;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"value"</span>, hue<span class="op">=</span><span class="st">"variable"</span>, data<span class="op">=</span>s2_prior_money_df, ax<span class="op">=</span>ax,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, lw<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span>prior_mean_money_nb, color<span class="op">=</span>cb_palette[<span class="dv">1</span>], ls<span class="op">=</span><span class="st">'dashed'</span>, lw<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span>prior_mean_money, color<span class="op">=</span>cb_palette[<span class="dv">0</span>], ls<span class="op">=</span><span class="st">'dashed'</span>, lw<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Distribution of Net Earnings Before and After Bonus"</span>)<span class="op">;</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So, that’s the prior-predictive distribution with respect to the <strong>final</strong> end-of-match payout, where we can already see (from the dashed vertical lines) that the bonus makes playing the game <strong>ever-so-slightly worth it</strong>, with an expected value now slightly above €0. This plot also explains why only the <strong>mean</strong> was affected: the bonus only affected the final money amounts by scaling up outcomes which were already above the 50% mark, leaving the median (the observation with exactly 50% of observations above it) unchanged.</p>
<p>And, since our model has two levels (round-level and match-level), we can also use our prior-predictive distribution to visualize the <strong>distribution of trajectories</strong>:</p>
<div id="6c7275e3-77bd-402a-a410-30bbcfbebd0e" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:29.057829Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:29.057645Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:29.732929Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:29.732492Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:29.057814Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_predictive_trajectories(df, suptitle, custom_bw_adjust<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a special t=0 row to each match, so the plotted trajectories start at</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (t,y) = (0,0)</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    t0_df <span class="op">=</span> pd.DataFrame({<span class="st">'t'</span>: <span class="dv">0</span>, <span class="st">'money_w_bonus'</span>: <span class="dv">0</span>, <span class="st">'draw'</span>: <span class="bu">range</span>(df[<span class="st">'draw'</span>].<span class="bu">max</span>())})</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> pd.concat([t0_df, df])</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    end_df <span class="op">=</span> df[df[<span class="st">'t'</span>] <span class="op">==</span> S2Game.rounds_per_match].copy()</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    mean_money <span class="op">=</span> end_df[<span class="st">'money_w_bonus'</span>].mean()</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    med_money <span class="op">=</span> end_df[<span class="st">'money_w_bonus'</span>].median()</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="fl">5.25</span>) <span class="co">#, ylim=(-30,15));</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_x.remove()<span class="op">;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean lines</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    full_range_plot <span class="op">=</span> sns.lineplot(</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_w_bonus"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>cb_palette[<span class="dv">0</span>],</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">100</span>),</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.125</span>),</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_w_bonus"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>cb_palette[<span class="dv">0</span>],</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">75</span>),</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.25</span>),</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_w_bonus"</span>,</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>cb_palette[<span class="dv">0</span>],</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">#errorbar=None,</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">50</span>),</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>        err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median trajectory outline in black</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_w_bonus"</span>, label<span class="op">=</span><span class="st">"Median of Simulated Rounds"</span>,</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dashed'</span>,</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean trajectory</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_w_bonus"</span>, label<span class="op">=</span><span class="st">"Mean of Simulated Rounds"</span>,</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df, ax<span class="op">=</span>grid.ax_joint,</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>        estimator<span class="op">=</span><span class="st">'mean'</span>,</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>        errorbar<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'dotted'</span>,</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>    grid.refline(</span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'solid'</span>, label<span class="op">=</span><span class="st">'Breaking Even'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># prior_grid.refline(</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     y=biased_end_df['money_at_round_end'].mean(),</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     color=cb_palette[1], lw=2,</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     label='Expected Payoff'</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># );</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)<span class="op">;</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.legend(['Breaking Even','Your Expected Payoff'], loc="left")</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(</span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"money_w_bonus"</span>, data<span class="op">=</span>df,</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>grid.ax_marg_y, fill<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>        bw_adjust<span class="op">=</span>custom_bw_adjust,</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># stat='density',</span></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># discrete=True,</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shrink=0.5,</span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Line on margin for mean</span></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.axhline(</span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mean_money, color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dotted'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.axhline(</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>med_money, color<span class="op">=</span><span class="st">'black'</span>, ls<span class="op">=</span><span class="st">'dashed'</span>, alpha<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.set_ylabel(<span class="st">"Money at Round End"</span>)<span class="op">;</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>    grid.ax_joint.set_title(<span class="st">"Round Level"</span>)<span class="op">;</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>    grid.ax_marg_y.set_title(<span class="st">"Match Level"</span>)<span class="op">;</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>    grid.fig.suptitle(suptitle)<span class="op">;</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>    grid.fig.set_figwidth(<span class="fl">9.5</span>)<span class="op">;</span></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>plot_predictive_trajectories(</span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>    s2_prior_df,</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a>    suptitle<span class="op">=</span><span class="st">"Prior Predictive Distributions"</span></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So now we can see, from this and the previous plot, that <strong>given our uncertainty about <code>p_sheisty</code> and <code>p_heads</code></strong>, it is <strong>just barely worthwhile to play!</strong> Even though the <strong>median</strong> of the game with and without the beating-sheisty bonus is the same, the <strong>mean</strong> with the bonus is just above €0.</p>
<p>In other words, <strong>given our state of knowledge about the game</strong> at this point, it <strong>is</strong> worthwhile to play (at least, on the assumption that we play if <span class="math inline">\(\mathbb{E}[Y] &gt; 0\)</span>.</p>
<p>However, each time you play a match with <span class="math inline">\(B\)</span>, you will obtain some <strong>information</strong> about (a) whether or not they have the <strong>Sheisty Coin</strong>, and then (b) <strong>if they do</strong> have it, what their bias level may be. So, in the next part we’ll simulate playing one round and then updating based on the results.</p>
</section>
</section>
<section id="part-4-updating-on-observed-data" class="level2">
<h2 class="anchored" data-anchor-id="part-4-updating-on-observed-data">[Part 4] Updating On Observed Data</h2>
<p>Now, let’s say you play one match with your friend, and you’re trying to determine whether it’s worthwhile to keep playing with them… How exactly would you figure this out? By what specific amounts should you <strong>update</strong> your distribution over <code>p_sheisty</code> and <code>p_heads</code>?</p>
<p>You could sit down and solve a gigantic 5100-style problem… or just <strong>plug the data into your Bayesian inference machine</strong>, namely, <strong>PyMC</strong> 😊</p>
<section id="part-4.1-your-single-observed-match" class="level3">
<h3 class="anchored" data-anchor-id="part-4.1-your-single-observed-match">[Part 4.1] Your (Single) Observed Match</h3>
<p>Here we’ll finally reveal the secret: though you, as player <span class="math inline">\(A\)</span>, don’t know it (this is the <strong>true DGP</strong> we’re simulating, finally, which is <strong>not observable</strong> to the actual agents playing the game!), player <span class="math inline">\(B\)</span> <strong>does</strong> indeed have the Sheisty Coin, and the random bias they’ve obtained puts their <code>p_heads</code> at <strong>0.41</strong>.</p>
<p>So, let’s simulate one match with this coin, keeping in mind that you-as-player-<span class="math inline">\(A\)</span> <strong>don’t know</strong> that this data was generated via <span class="math inline">\(p = 0.48\)</span> – you <strong>only know</strong> that the match ended up with the following trajectory and outcome:</p>
<div id="a76706d7-0bef-4a18-812d-315ee53c6286" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:35.159140Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:35.158851Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:35.161880Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:35.161457Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:35.159124Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>true_is_sheisty <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>true_p_heads <span class="op">=</span> <span class="fl">0.48</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ff7e0d8a-5c1d-4b4b-ab19-eb7bfa8bd7a8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:35.789391Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:35.789220Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:35.800317Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:35.799928Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:35.789376Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sim_s2_match(p, rng_seed<span class="op">=</span><span class="dv">5650</span>):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    sim_rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span>rng_seed)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    round_outcomes <span class="op">=</span> sim_rng.binomial(n<span class="op">=</span>Game.flips_per_round, p<span class="op">=</span>p, size<span class="op">=</span>Game.rounds_per_match)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    match_df <span class="op">=</span> pd.DataFrame({<span class="st">'t'</span>: <span class="bu">range</span>(<span class="dv">1</span>,Game.rounds_per_match<span class="op">+</span><span class="dv">1</span>), <span class="st">'num_heads'</span>: round_outcomes})</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    match_df[<span class="st">'money_change'</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (match_df[<span class="st">'num_heads'</span>] <span class="op">&gt;</span> Game.win_cutoff)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    match_df[<span class="st">'money_at_round_end'</span>] <span class="op">=</span> match_df[<span class="st">'money_change'</span>].cumsum()</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># New in Season 2: Quintupling your money when it's above 0!</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    match_df[<span class="st">'money_w_bonus'</span>] <span class="op">=</span> match_df[<span class="st">'money_at_round_end'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: S2Game.bonus_multiplier <span class="op">*</span> x <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> x) </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    t0_df <span class="op">=</span> pd.DataFrame({<span class="st">'t'</span>:[<span class="dv">0</span>],<span class="st">'money_at_round_end'</span>:[<span class="dv">0</span>],<span class="st">'money_change'</span>:[<span class="dv">0</span>]})</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    match_df <span class="op">=</span> pd.concat([t0_df, match_df])</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(match_df)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>obs_df <span class="op">=</span> sim_s2_match(true_p_heads)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>obs_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>46</td>
<td>-14</td>
<td>1</td>
<td>8.0</td>
<td>-14.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>47</td>
<td>-15</td>
<td>-1</td>
<td>4.0</td>
<td>-15.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>48</td>
<td>-14</td>
<td>1</td>
<td>8.0</td>
<td>-14.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48</td>
<td>49</td>
<td>-13</td>
<td>1</td>
<td>7.0</td>
<td>-13.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>50</td>
<td>-14</td>
<td>-1</td>
<td>5.0</td>
<td>-14.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ec4e20ae-f926-4870-af03-696df2b36480" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:36.978073Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:36.977752Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:37.195386Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:37.194986Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:36.978046Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>obs_grid <span class="op">=</span> sns.JointGrid(height<span class="op">=</span><span class="dv">5</span>) <span class="co"># , ylim=(-30,15));</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>obs_grid.refline(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">'solid'</span>, label<span class="op">=</span><span class="st">'Breaking Even'</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean lines</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"money_at_round_end"</span>, label<span class="op">=</span><span class="st">"Observed Trajectory"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>obs_df, ax<span class="op">=</span>obs_grid.ax_joint,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span><span class="st">'median'</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#errorbar=None,</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    errorbar<span class="op">=</span>(<span class="st">'pi'</span>,<span class="dv">50</span>),</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    err_kws<span class="op">=</span><span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.15</span>),</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>obs_grid.ax_marg_x.remove()<span class="op">;</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>obs_grid.refline(</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>obs_df.iloc[<span class="op">-</span><span class="dv">1</span>][<span class="st">'money_at_round_end'</span>],</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>cb_palette[<span class="dv">0</span>], lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Obseved Payoff'</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>obs_grid.ax_joint.legend(loc<span class="op">=</span><span class="st">"lower left"</span>)<span class="op">;</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.legend(['Breaking Even','Your Expected Payoff'], loc="left")</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.kdeplot(</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     y="money_at_round_end", hue="params", data=combined_end_df,</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax=biased_grid.ax_marg_y, fill=True, legend=False,</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     # stat='density',</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     # discrete=True,</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     # shrink=0.5,</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="co"># );</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>obs_grid.ax_joint.set_ylabel(<span class="st">"Money at Round End"</span>)<span class="op">;</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>obs_grid.fig.set_figwidth(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-58-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So, by the end of this match, you ended up with €14 less than you started with. If you only knew this final amount, you would essentially have one “bit” of information. However, you have more than this! You also know the <strong>trajectory</strong> from <span class="math inline">\(t = 0\)</span> to <span class="math inline">\(t = 50\)</span>, which gives you much more information you can use to update your model parameters.</p>
<p>Let’s use PyMC as it was fully intended, by pairing our model with this <strong>observed data</strong>, and then see how this changes whether or not it’s still worth it to play against <span class="math inline">\(B\)</span>!</p>
</section>
<section id="part-4.2-adding-the-observations-to-our-model-and-updating" class="level3">
<h3 class="anchored" data-anchor-id="part-4.2-adding-the-observations-to-our-model-and-updating">[Part 4.2] Adding the Observations to Our Model and Updating</h3>
<p>Since our model doesn’t actually incorporate the <span class="math inline">\(t = 0\)</span> row (we added that just to make the plots a bit more readable), we drop these rows and then set <code>obs_df</code> without these rows as the observed data for our model.</p>
<div id="bfaffc38-a8bf-411f-9599-bc2bad360385" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:39.623026Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:39.622683Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:39.627201Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:39.626743Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:39.622999Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>obs_t1_df <span class="op">=</span> obs_df[obs_df[<span class="st">'t'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].copy().set_index(<span class="st">'t'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4f5aa96d-97b1-40cd-aa5a-323fa2e12b5a" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:43:09.901070Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:43:09.900785Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:43:09.983917Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:43:09.983343Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:43:09.901052Z&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'t'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, Game.rounds_per_match <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> s2_model_obs:</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unobservable prior parameters</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    p_sheisty <span class="op">=</span> pm.Uniform(<span class="st">"p_sheisty"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    is_sheisty <span class="op">=</span> pm.Bernoulli(<span class="st">"is_sheisty"</span>, p<span class="op">=</span>p_sheisty)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    fair_p_heads <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    sheisty_p_heads <span class="op">=</span> pm.Uniform(<span class="st">"sheisty_p_heads"</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    p_heads <span class="op">=</span> pm.Deterministic(</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"p_heads"</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>            is_sheisty,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>            sheisty_p_heads,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>            fair_p_heads</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Observable parameters</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The flips</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    num_heads <span class="op">=</span> pm.Binomial(</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"num_heads"</span>, n<span class="op">=</span>Game.flips_per_round, p<span class="op">=</span>p_heads,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span>, observed<span class="op">=</span>obs_t1_df[<span class="st">'num_heads'</span>]</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The round result</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    money_change <span class="op">=</span> pm.Deterministic(</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_change"</span>,</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(pm.math.gt(num_heads, Game.win_cutoff), <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The cumulative result</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    money_at_round_end <span class="op">=</span> pm.Deterministic(</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_at_round_end"</span>,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>        pm.math.cumsum(money_change, <span class="dv">0</span>),</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And the doubling-at-end if we win</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    money_w_bonus <span class="op">=</span> pm.Deterministic(</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"money_w_bonus"</span>,</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>            pm.math.gt(money_at_round_end, <span class="dv">0</span>),</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>            S2Game.bonus_multiplier <span class="op">*</span> money_at_round_end,</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>            money_at_round_end</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>        dims<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(s2_model_obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-60-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-4.3-sample-from-posterior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="part-4.3-sample-from-posterior-distribution">[Part 4.3] Sample from Posterior Distribution</h3>
<div id="c3c4529e-5191-4a9d-bb36-d3e8fab9d5bb" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:42.365731Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:42.365484Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:45.926926Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:45.926310Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:42.365716Z&quot;}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s2_model_obs:</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    s2_post_idata <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">5650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Multiprocess sampling (4 chains in 4 jobs)
CompoundStep
&gt;NUTS: [p_sheisty, sheisty_p_heads]
&gt;BinaryGibbsMetropolis: [is_sheisty]</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"be5d73c5a19b49d997f650880cd8fb21","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 2 seconds.</code></pre>
</div>
</div>
<div id="d00800e3-c5ed-465d-a000-91f11afb8c77" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:46.586954Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:46.586732Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:46.637596Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:46.637063Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:46.586933Z&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>s2_post_df <span class="op">=</span> s2_post_idata.posterior.to_dataframe().reset_index()</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>s2_post_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">chain</th>
<th data-quarto-table-cell-role="th">draw</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">is_sheisty</th>
<th data-quarto-table-cell-role="th">p_sheisty</th>
<th data-quarto-table-cell-role="th">sheisty_p_heads</th>
<th data-quarto-table-cell-role="th">p_heads</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>-1</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>-1</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>-1</td>
<td>-2</td>
<td>-2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>1</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199995</td>
<td>3</td>
<td>999</td>
<td>46</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199996</td>
<td>3</td>
<td>999</td>
<td>47</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>-1</td>
<td>-15</td>
<td>-15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199997</td>
<td>3</td>
<td>999</td>
<td>48</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199998</td>
<td>3</td>
<td>999</td>
<td>49</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>1</td>
<td>-13</td>
<td>-13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199999</td>
<td>3</td>
<td>999</td>
<td>50</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
</tbody>
</table>

<p>200000 rows × 10 columns</p>
</div>
</div>
</div>
<div id="0d389f75-8c67-40f9-8ca0-ccf12dbcc563" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:48.021270Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:48.021022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:48.033033Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:48.032532Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:48.021252Z&quot;}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>s2_post_end_df <span class="op">=</span> s2_post_df[s2_post_df[<span class="st">'t'</span>] <span class="op">==</span> S2Game.rounds_per_match].copy()</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>s2_post_end_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">chain</th>
<th data-quarto-table-cell-role="th">draw</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">is_sheisty</th>
<th data-quarto-table-cell-role="th">p_sheisty</th>
<th data-quarto-table-cell-role="th">sheisty_p_heads</th>
<th data-quarto-table-cell-role="th">p_heads</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>0</td>
<td>0</td>
<td>50</td>
<td>1</td>
<td>0.634665</td>
<td>0.425275</td>
<td>0.425275</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>0</td>
<td>1</td>
<td>50</td>
<td>1</td>
<td>0.941787</td>
<td>0.466247</td>
<td>0.466247</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">149</td>
<td>0</td>
<td>2</td>
<td>50</td>
<td>1</td>
<td>0.201438</td>
<td>0.432916</td>
<td>0.432916</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199</td>
<td>0</td>
<td>3</td>
<td>50</td>
<td>1</td>
<td>0.910678</td>
<td>0.445946</td>
<td>0.445946</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>0</td>
<td>4</td>
<td>50</td>
<td>1</td>
<td>0.500935</td>
<td>0.446615</td>
<td>0.446615</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199799</td>
<td>3</td>
<td>995</td>
<td>50</td>
<td>1</td>
<td>0.204122</td>
<td>0.475606</td>
<td>0.475606</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199849</td>
<td>3</td>
<td>996</td>
<td>50</td>
<td>1</td>
<td>0.915687</td>
<td>0.422559</td>
<td>0.422559</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199899</td>
<td>3</td>
<td>997</td>
<td>50</td>
<td>1</td>
<td>0.321373</td>
<td>0.466857</td>
<td>0.466857</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199949</td>
<td>3</td>
<td>998</td>
<td>50</td>
<td>1</td>
<td>0.486654</td>
<td>0.461348</td>
<td>0.461348</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199999</td>
<td>3</td>
<td>999</td>
<td>50</td>
<td>1</td>
<td>0.902354</td>
<td>0.431539</td>
<td>0.431539</td>
<td>-1</td>
<td>-14</td>
<td>-14</td>
</tr>
</tbody>
</table>

<p>4000 rows × 10 columns</p>
</div>
</div>
</div>
<div id="dd519c83-0a6c-470b-b2a4-939de3770ae8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:48.278388Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:48.278206Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:48.429567Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:48.429039Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:48.278372Z&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"p_sheisty"</span>, data<span class="op">=</span>s2_post_end_df, ax<span class="op">=</span>ax</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Posterior Distribution of p_sheisty"</span>)<span class="op">;</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-64-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ea28f52c-3b3e-4ed5-8610-737ba72d68df" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:48.700831Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:48.700622Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:48.826510Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:48.826011Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:48.700814Z&quot;}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"is_sheisty"</span>, data<span class="op">=</span>s2_post_end_df, ax<span class="op">=</span>ax</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Posterior Distribution of is_sheisty"</span>)<span class="op">;</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="68d8e4b3-572b-4597-b61f-089f8c467c62" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:49.001303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:49.001065Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:49.147536Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:49.147003Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:49.001287Z&quot;}" data-execution_count="65">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="fl">3.5</span>, <span class="fl">2.25</span>))<span class="op">;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"p_heads"</span>, data<span class="op">=</span>s2_post_end_df, ax<span class="op">=</span>ax</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Posterior Distribution of p_heads"</span>)<span class="op">;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-66-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-4.4-sample-from-posterior-predictive-distribution" class="level3">
<h3 class="anchored" data-anchor-id="part-4.4-sample-from-posterior-predictive-distribution">[Part 4.4] Sample from Posterior <em>Predictive</em> Distribution</h3>
<div id="dec3385f-c033-4dbf-8d67-57565eb62e32" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:50.084783Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:50.084550Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:50.391301Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:50.390781Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:50.084766Z&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s2_model_obs:</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    s2_post_pred_idata <span class="op">=</span> pm.sample_posterior_predictive(s2_post_idata, random_seed<span class="op">=</span><span class="dv">5650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling: [num_heads]</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"42f48b2b82c64eb98532751d9d3c437f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div id="4669e840-844b-4153-bc6f-c112f5bad26d" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:51.800912Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:51.800680Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:51.845027Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:51.844518Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:51.800894Z&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>s2_post_pred_df <span class="op">=</span> s2_post_pred_idata.posterior_predictive.to_dataframe().reset_index()</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>s2_post_pred_df[<span class="st">'source'</span>] <span class="op">=</span> <span class="st">"Posterior Predictive"</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>s2_post_pred_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">chain</th>
<th data-quarto-table-cell-role="th">draw</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">num_heads</th>
<th data-quarto-table-cell-role="th">money_change</th>
<th data-quarto-table-cell-role="th">money_at_round_end</th>
<th data-quarto-table-cell-role="th">money_w_bonus</th>
<th data-quarto-table-cell-role="th">source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>-1</td>
<td>-1</td>
<td>-1</td>
<td>Posterior Predictive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>-1</td>
<td>-2</td>
<td>-2</td>
<td>Posterior Predictive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>-1</td>
<td>-3</td>
<td>-3</td>
<td>Posterior Predictive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>-1</td>
<td>-4</td>
<td>-4</td>
<td>Posterior Predictive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>4</td>
<td>-1</td>
<td>-5</td>
<td>-5</td>
<td>Posterior Predictive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199995</td>
<td>3</td>
<td>999</td>
<td>46</td>
<td>7</td>
<td>1</td>
<td>-16</td>
<td>-16</td>
<td>Posterior Predictive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199996</td>
<td>3</td>
<td>999</td>
<td>47</td>
<td>5</td>
<td>-1</td>
<td>-17</td>
<td>-17</td>
<td>Posterior Predictive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199997</td>
<td>3</td>
<td>999</td>
<td>48</td>
<td>5</td>
<td>-1</td>
<td>-18</td>
<td>-18</td>
<td>Posterior Predictive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199998</td>
<td>3</td>
<td>999</td>
<td>49</td>
<td>4</td>
<td>-1</td>
<td>-19</td>
<td>-19</td>
<td>Posterior Predictive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199999</td>
<td>3</td>
<td>999</td>
<td>50</td>
<td>7</td>
<td>1</td>
<td>-18</td>
<td>-18</td>
<td>Posterior Predictive</td>
</tr>
</tbody>
</table>

<p>200000 rows × 8 columns</p>
</div>
</div>
</div>
<div id="7ae951da-6485-48e1-a8a1-7ccc91150559" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2025-06-30T07:42:52.426935Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-06-30T07:42:52.426722Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-06-30T07:42:53.987363Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-06-30T07:42:53.986822Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-06-30T07:42:52.426919Z&quot;}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plot_predictive_trajectories(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    s2_post_pred_df,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    suptitle<span class="op">=</span><span class="st">"Posterior Predictive Distributions"</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian_Workflow_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So… by incorporating what we learned from the one round about the possibility that <span class="math inline">\(B\)</span> has the Sheisty Coin, we’ve learn that it is <strong>no longer worthwhile</strong> to keep playing against <span class="math inline">\(B\)</span>!</p>
<p>We can see, up in the portion above the “Breaking Even” line, the tantalizing 1% of matches that end in huge fortunes for us. Taking this <strong>risk-reward tradeoff</strong> into account would take us into the even more… complex-but-important realm of <strong>Bayesian Decision Theory!</strong></p>
<p>As a motivation to take the additional deep-dive into this field, imo it is <strong>especially, incredibly important</strong> for those interested in public policy. The Minnesota Radon data mentioned in class, for example, was part of a much broader case-study of how Bayesian data analysis can be used to provide policy recommendations, and following the Bayesian Workflow beyond the contents of this notebook and into Bayesian Decision Theory will allow you to construct plots like this, providing explicit Bayes-Theorem-optimized recommendations to policymakers:</p>
<center>
<figure class="figure">
<img src="https://raw.githubusercontent.com/jpowerj/dsan-content/45847ccbb4798499bb9bd91a145f67d9f96257a2/2025-sum-dsan5650/writeups/decision.svg" width="85%" class="figure-img">
<figcaption>
<i>The Bayesian Decision Analysis plot from <b>Gelman et al.&nbsp;(2014), Bayesian Data Analysis (Third Edition)</b></i>
</figcaption>
</figure>
</center>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"42f48b2b82c64eb98532751d9d3c437f":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"layout":"IPY_MODEL_f82b7be0e7f64fbe94a6ab650214b52d","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Sampling ... <span style=\"color: #008000; text-decoration-color: #008000\">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span style=\"color: #800080; text-decoration-color: #800080\">100%</span> 0:00:00 / 0:00:00\n</pre>\n","text/plain":"Sampling ... \u001b[32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[35m100%\u001b[0m 0:00:00 / 0:00:00\n"},"metadata":{},"output_type":"display_data"}]}},"9c2fbe60ee164c0d89c1d0702fe59950":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{}},"be5d73c5a19b49d997f650880cd8fb21":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"layout":"IPY_MODEL_9c2fbe60ee164c0d89c1d0702fe59950","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">                                                                                                                   \n <span style=\"font-weight: bold\"> Progress                 </span> <span style=\"font-weight: bold\"> Draws </span> <span style=\"font-weight: bold\"> Divergences </span> <span style=\"font-weight: bold\"> Step size </span> <span style=\"font-weight: bold\"> Grad evals </span> <span style=\"font-weight: bold\"> Sampling Speed  </span> <span style=\"font-weight: bold\"> Elapsed </span> <span style=\"font-weight: bold\"> Remaining </span> \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             1.17        3            1526.80 draws/s   0:00:01   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.87        1            1454.23 draws/s   0:00:01   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.99        3            1571.75 draws/s   0:00:01   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.72        7            1349.27 draws/s   0:00:01   0:00:00    \n                                                                                                                   \n</pre>\n","text/plain":"                                                                                                                   \n \u001b[1m \u001b[0m\u001b[1mProgress                \u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDraws\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDivergences\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mStep size\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mGrad evals\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mSampling Speed \u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mElapsed\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mRemaining\u001b[0m\u001b[1m \u001b[0m \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             1.17        3            1526.80 draws/s   0:00:01   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.87        1            1454.23 draws/s   0:00:01   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.99        3            1571.75 draws/s   0:00:01   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.72        7            1349.27 draws/s   0:00:01   0:00:00    \n                                                                                                                   \n"},"metadata":{},"output_type":"display_data"}]}},"f82b7be0e7f64fbe94a6ab650214b52d":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jpowerj/dsan5650/blob/main/writeups/bayesian-workflow/Bayesian_Workflow.ipynb" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>